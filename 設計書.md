# 1. 概要

- 本ツールは、`Microsoft Teams` におけるプロジェクト成果物管理の標準フォルダ構造を自動で生成する `Python` スクリプトである。
- 指定されたプロジェクト名、アイテム名に基づき、年度・四半期フォルダ、工程フォルダ、成果物フォルダ、内部・外部レビューフォルダ、およびダミーファイル群を自動生成する。
- これにより、プロジェクト開始時の環境構築の手間を削減し、フォルダ構成の標準化を促進する。

# 2. 想定環境

| 項目           | 詳細                                                                                                                      |
| :------------- | :------------------------------------------------------------------------------------------------------------------------ |
| OS             | Windows, macOS, Linux (Python が動作する環境)                                                                             |
| Python         | 3.8 以上                                                                                                                  |
| 依存ライブラリ | configparser (標準ライブラリ)<br>pathlib (標準ライブラリ)<br>openpyxl (Excel ファイル操作用)<br>datetime (標準ライブラリ) |

# 3. 機能一覧

| No. | 機能 ID | 機能名                    | 概要                                                                                                                                                             |
| --- | ------- | ------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1   | F001    | 設定ファイル読み込み      | `config.ini`からプロジェクトパス、名称、ファイルタイトル等の設定を読み込む。                                                                                     |
| 2   | F002    | ダミー Excel ファイル生成 | 指定されたファイルタイプと内容でダミーの Excel ファイルを生成する。Excel 生成に失敗した場合はテキストファイルで代替する。                                        |
| 3   | F003    | ファイル生成 (汎用)       | ファイルタイプに応じて、Excel ダミーまたは空の Python ファイルを生成する。ファイルパス、プレフィックス、プロジェクト情報、タイトルキーを基にファイルを作成する。 |
| 4   | F004    | レビュー関連ファイル生成  | レビュー日付フォルダ、およびその中に主要成果物、レビューチェックリスト、レビュー記録表を生成する。                                                               |
| 5   | F005    | サンプル構造生成          | `config.ini`に基づいて、プロジェクトルート、四半期フォルダ、各工程フォルダ、成果物/レビューフォルダ、および関連ファイルを一括生成する。                          |

# 4. コンポーネント設計

## 4.1. モジュール構成

```
project_structure_generator.py (メインスクリプト)
├── config.ini (設定ファイル)
```

## 4.2. 定義済み定数

### ファイルの種類

ファイルの種類を識別するための整数値定数です。

| 定数名                       | 値  | 説明                   |
| :--------------------------- | :-- | :--------------------- |
| `FILE_TYPE_MAIN`             | `1` | メイン成果物資料       |
| `FILE_TYPE_REVIEW_CHECKLIST` | `2` | レビューチェックリスト |
| `FILE_TYPE_REVIEW_MINUTES`   | `3` | レビュー記録表         |
| `FILE_TYPE_PYTHON`           | `4` | Python ファイル        |

---

### ファイルタイプ ID と表示名のマッピング

`create_dummy_excel_file` 関数で使用される、ファイルタイプ ID と表示名のマッピングです。

| ID  | 表示名                   |
| :-- | :----------------------- |
| `1` | "メイン資料"             |
| `2` | "レビューチェックリスト" |
| `3` | "レビュー記録表"         |

---

### 工程別主要成果物情報

各工程番号（キー）に対応する主要成果物の情報（辞書またはリスト）を定義します。

- **キー**: 工程番号 (例: `"030"`, `"040"`)

- **値 (単一ファイルの場合)**: 以下のキーを持つ辞書

  - `"main"`: 主要成果物のファイル名プレフィックス (例: `"調査検討書"`)
  - `"title_key"`: `config.ini` の `[title]` セクションからタイトルを取得するためのキー (例: `"research"`)
  - `"type"`: `FILE_TYPE_PYTHON` など、特殊なファイルタイプを指定 (デフォルトは `FILE_TYPE_MAIN`)

- **値 (複数ファイルの場合)**: 上記辞書のリスト (例: `"090"`工程)

---

### 工程番号と工程名のマッピング

工程番号（キー）と工程名（値）の対応関係を定義します。これはフォルダ名生成に使用されます。

| 工程番号 | 工程名    |
| :------- | :-------- |
| `"030"`  | "調査"    |
| `"040"`  | "設計"    |
| `"050"`  | "製造"    |
| `"060"`  | "UD 作成" |
| `"070"`  | "UD 消化" |
| `"080"`  | "SD 作成" |
| `"090"`  | "SD 消化" |

# 5. 関数設計

## 5.1. `load_config`

- **機能 ID**: F001
- **概要**: 指定された設定ファイルを読み込み、`configparser` オブジェクトとして返す。

### 関数

```Python
def load_config(
    config_file: str = "config.ini"
):
```

### 引数

- `config_file` (`str`, オプション): 読み込む設定ファイルのパス。デフォルトは `"config.ini"`。

### 戻り値

- `configparser.ConfigParser` オブジェクト。

### 処理フロー

1.  `configparser.ConfigParser()` インスタンスを生成する。
2.  `config.read(config_file)` を呼び出し、設定ファイルを読み込む。
3.  読み込んだ `config` オブジェクトを返す。

---

## 5.2. `create_dummy_excel_file`

- **機能 ID**: F002
- **概要**: 指定された情報に基づき、ダミーの Excel ファイルを生成する。特定のファイルタイプに応じた内容をセルに書き込む。Excel ファイル生成に失敗した場合は、警告ログを出力し、代わりにテキストファイルを作成する。

### 関数

```Python
def create_dummy_excel_file(
    type: int,
    title: str,
    project_name: str,
    item_name: str,
    file_path: Path
):
```

### 引数

- `type` (`int`): ファイルタイプを識別する整数値 (`FILE_TYPE_MAIN` など)。
- `title` (`str`): ファイルのタイトル。Excel ファイルの内容に反映される。
- `project_name` (`str`): プロジェクト名。Excel ファイルの内容に反映される。
- `item_name` (`str`): アイテム名。Excel ファイルの内容に反映される。
- `file_path` (`pathlib.Path`): 生成するファイルの完全なパス。

### 戻り値

- 成功した場合は `True`、失敗した場合は `False`。

### 処理フロー

1.  **入力バリデーション**:
    - `type` が整数でない場合、`TypeError` を発生させる。
    - `type` が `FILE_TYPE` 辞書に存在しない場合、`ValueError` を発生させる。
    - 上記のエラーが発生した場合、エラーログを出力し `False` を返す。
2.  `openpyxl.Workbook()` を使用して新しい Excel ワークブックを生成する。
3.  アクティブなワークシートを取得する。
4.  **ファイルタイプに応じたセルへの書き込み**:
    - `type` が `FILE_TYPE_MAIN` の場合:
      - セル `"B5"` に `title`、`project_name`、`item_name` を改行区切りで書き込む。
      - セル `"B5"` のアライメントを `wrap_text=True` に設定する。
      - セル `"A1"` に `"これはメイン資料です。ファイル名: [ファイル名]"` を書き込む。
    - `type` が `FILE_TYPE_REVIEW_CHECKLIST` の場合:
      - セル `"B2"` に `"レビューチェックリスト"` を書き込む。
      - セル `"B3"` に `title` を書き込む。
      - セル `"B4"` に `project_name` を書き込む。
      - セル `"B5"` に `item_name` を書き込む。
      - セル `"A1"` に `"これはレビューチェックリストです。ファイル名: [ファイル名]"` を書き込む。
    - `type` が `FILE_TYPE_REVIEW_MINUTES` の場合:
      - セル `"B2"` に `"レビュー記録表"` を書き込む。
      - セル `"G2"` に `project_name`、`item_name`、`title` を結合したレビュータイトルを書き込む。
      - セル `"A1"` に `"これはレビュー記録表です。ファイル名: [ファイル名]"` を書き込む。
    - 上記以外の `type` の場合 (フォールバック):
      - セル `"A1"` に `"不明なファイルタイプ ([type]) のダミー Excel です。ファイル名: [ファイル名]"` を書き込む。
5.  `wb.save(file_path)` を呼び出し、Excel ファイルを保存する。
6.  成功ログを出力し `True` を返す。
7.  **例外処理**:
    - Excel ファイル生成中に何らかの `Exception` が発生した場合、警告ログを出力する。
    - `file_path` で指定されたパスに、エラー情報を含むテキストファイルを代替として作成する。
    - `False` を返す。

---

## 5.3. `create_file_with_title`

- **機能 ID**: F003
- **概要**: 指定されたファイルタイプに応じて、ファイルを作成する。Python ファイルの場合は空の `.py` ファイルを、それ以外の場合は `create_dummy_excel_file` を呼び出してダミー Excel ファイルを生成する。

### 関数

```Python
def create_file_with_title(
    file_type: int,
    base_dir: Path,
    file_prefix: str,
    config: configparser.ConfigParser,
    project_name: str,
    item_name: str,
    specific_title_key: str = None,
    file_extension: str = ".xlsx"
):
```

### 引数

- `file_type` (`int`): ファイルタイプを識別する整数値 (`FILE_TYPE_MAIN` など)。
- `base_dir` (`pathlib.Path`): ファイルを生成する基底ディレクトリ。
- `file_prefix` (`str`): ファイル名のプレフィックス。
- `config` (`configparser.ConfigParser`): 設定情報を含むオブジェクト。
- `project_name` (`str`): プロジェクト名。
- `item_name` (`str`): アイテム名。
- `specific_title_key` (`str`, オプション): `config['title']` からタイトルを取得するためのキー。指定がない場合、`file_prefix` から推測する。
- `file_extension` (`str`, オプション): ファイルの拡張子。デフォルトは `".xlsx"`。

### 戻り値

- 生成されたファイルの `pathlib.Path` オブジェクト、または生成に失敗した場合は `None`。

### 処理フロー

1.  `base_dir` が存在しない場合、`base_dir.mkdir(parents=True, exist_ok=True)` で作成する。
2.  **ファイルタイプによる分岐**:
    - `file_type` が `FILE_TYPE_PYTHON` の場合:
      - `file_path` を `base_dir / f"{file_prefix}.py"` として構築する。
      - `file_path.touch()` を呼び出し、空の Python ファイルを生成する。
      - デバッグログを出力し、`file_path` を返す。
    - 上記以外 (Excel ファイル) の場合:
      - `specific_title_key` が指定されていればそれを使用し、なければ `file_prefix` を整形して `title_key` を推測する (例: `"調査検討書"` -> `"research"`)。
      - `config['title'].get(title_key, file_prefix)` を使用して、`config.ini` からタイトル文字列 (`title_from_config`) を取得する。設定にキーがない場合は `file_prefix` をフォールバックとして使用する。
      - ファイル名を `f"{file_prefix}_{project_name}_{item_name}{file_extension}"` の形式で構築する。
      - `file_path` を `base_dir / file_name` として構築する。
      - `create_dummy_excel_file` を呼び出し、ダミー Excel ファイルを生成する。
      - `create_dummy_excel_file` の戻り値が `True` なら `file_path` を、`False` なら `None` を返す。

---

## 5.4. `create_review_files`

- **機能 ID**: F004
- **概要**: レビュー関連のフォルダ構造（日付フォルダ）と、その中に主要成果物、レビューチェックリスト、レビュー記録表ファイルを生成する。

### 関数

```Python
def create_review_files(
    base_folder: Path,
    date_obj: datetime.date,
    suffix: str,
    config: configparser.ConfigParser,
    project_name: str,
    item_name: str,
    p_num: str,
    p_name: str,
    main_file_path_stems: list[str]
):
```

### 引数

- `base_folder` (`pathlib.Path`): レビュー日付フォルダを生成する基底ディレクトリ (例: `"内部レビュー"` または `"外部レビュー"` フォルダ)。
- `date_obj` (`datetime.date`): レビュー日付。フォルダ名 (`YYYYMMDD`) に使用される。
- `suffix` (`str`): ファイル名に付加するサフィックス (例: `"社内_1 回目"`)。
- `config` (`configparser.ConfigParser`): 設定情報を含むオブジェクト。
- `project_name` (`str`): プロジェクト名。
- `item_name` (`str`): アイテム名。
- `p_num` (`str`): 工程番号 (例: `"030"`)。
- `p_name` (`str`): 工程名 (例: `"調査"`)。
- `main_file_path_stems` (`list[str]`): 当該工程の主要成果物ファイルのプレフィックスのリスト。これらのファイルもレビュー日付フォルダ内に再生成される。

### 戻り値

- 生成された日付フォルダの `pathlib.Path` オブジェクト。

### 処理フロー

1.  `date_obj` を用いて、日付フォルダ名 (`YYYYMMDD`) を生成する。
2.  `date_folder` (`base_folder / YYYYMMDD`) を作成する (`exist_ok=True` で既存の場合はエラーとしない)。
3.  ログに日付フォルダ作成を記録する。
4.  **主要成果物ファイルの再生成**:
    - `main_file_path_stems` リストをループ処理する。
    - 各 `main_stem` (ファイルプレフィックス) から、`config.ini` からタイトルを取得するための `inferred_title_key` を推測する。
      - `"書"` を含む場合、`"書"` を除去して小文字化 (例: `"調査検討書"` -> `"research"`)。
      - `"結合試験成績書"` の場合は `"sys_test_rst"`。
      - `"試験結果報告書"` の場合は `"test_rst_report"`。
      - 上記以外はそのまま小文字化。
    - `create_file_with_title` を `FILE_TYPE_MAIN` で呼び出し、主要成果物を日付フォルダ内に再生成する。
5.  **レビューチェックリストの生成**:
    - `create_file_with_title` を `FILE_TYPE_REVIEW_CHECKLIST` で呼び出し、`f"レビューチェックリスト_{p_num}_{suffix}"` をプレフィックスとしてレビューチェックリストを生成する。`specific_title_key` は `"review_checklist"` とする。
6.  **レビュー記録表の生成**:
    - `create_file_with_title` を `FILE_TYPE_REVIEW_MINUTES` で呼び出し、`f"レビュー記録表_{p_name}_{suffix}"` をプレフィックスとしてレビュー記録表を生成する。`specific_title_key` は `"review_minutes"` とする。
7.  生成した `date_folder` を返す。

---

## 5.5. `create_sample_teams_structure`

- **機能 ID**: F005
- **概要**: `config.ini` から読み込んだ情報に基づき、プロジェクト全体の Teams 風フォルダ構造とダミーファイルを一括で生成するメイン関数。

### 関数

```Python
def create_sample_teams_structure(
    config: configparser.ConfigParser
):
```

### 引数

- `config` (`configparser.ConfigParser`): 設定情報を含むオブジェクト。

### 戻り値

- なし。

### 処理フロー

1.  `config` から `sample_teams_root`、`project_name`、`item_name` を取得する。
2.  キーが存在しない場合、エラーログを出力し、処理を中断する。
3.  **プロジェクトルートフォルダの作成**:
    - `project_root` (`sample_teams_root / project_name / item_name`) を構築し、`mkdir(parents=True, exist_ok=True)` で作成する。
    - 作成ログを出力する。
4.  **四半期フォルダの作成**:
    - 現在の日付から現在の年と四半期を算出し、`YYYY_Q Q` 形式の `quarter_folder` 名を生成する。
    - `teams_base_path` (`project_root / quarter_folder`) を構築し、`mkdir(exist_ok=True)` で作成する。
    - 作成ログを出力する。
5.  **日付サンプルの定義**:
    - `today` を基準に、過去 7 日、5 日、3 日、1 日の日付を `DATE_SAMPLES` 辞書に定義する (内部レビュー 1 回目、2 回目、外部レビュー 1 回目、2 回目用)。
6.  **各工程のループ処理**:
    - `PROCESS_MAP` をループし、各 `p_num` (工程番号) と `p_name` (工程名) に対して以下の処理を行う。
      1.  **工程フォルダの作成**:
          - `process_dir` (`teams_base_path / f"{p_num}.{p_name}"`) を構築し、`mkdir(exist_ok=True)` で作成する。
          - 作成ログを出力する。
      2.  **主要成果物ファイルリストの初期化**:
          - `main_file_stem_for_review` という空のリストを初期化する。これは当該工程で作成される主要成果物のファイルプレフィックスを格納し、レビューファイル生成時に渡される。
      3.  **主要成果物ファイルの作成**:
          - `PROCESS_FILES.get(p_num)` から当該工程の成果物情報 (`process_file_info`) を取得する。
          - `process_file_info` が辞書 (`dict`) の場合 (単一ファイル):
            - `file_type_to_use` を `process_file_info.get("type", FILE_TYPE_MAIN)` から取得する。
            - `file_type_to_use` が `FILE_TYPE_PYTHON` の場合:
              - `create_file_with_title` を呼び出し、Python ファイルを生成する。`specific_title_key` は `None` とする。
            - 上記以外の場合 (Excel ファイル):
              - `create_file_with_title` を呼び出し、Excel ファイルを生成する。`specific_title_key` は `process_file_info["title_key"]` を指定する。
            - ファイルが正常に生成された場合、そのファイル名プレフィックスを `main_file_stem_for_review` に追加する。
          - `process_file_info` がリスト (`list`) の場合 (複数ファイル):
            - リスト内の各 `file_data` (辞書) をループ処理する。
            - `create_file_with_title` を呼び出し、Excel ファイルを生成する。`file_type_to_use` は `file_data.get("type", FILE_TYPE_MAIN)` から、`specific_title_key` は `file_data["title_key"]` から取得する。
            - ファイルが正常に生成された場合、そのファイル名プレフィックスを `main_file_stem_for_review` に追加する。
      4.  **成果物フォルダの作成**:
          - `results_dir` (`process_dir / "成果物"`) を構築し、`mkdir(exist_ok=True)` で作成する。
          - 作成ログを出力する。
      5.  **内部レビューフォルダの作成**:
          - `internal_review_dir` (`results_dir / "内部レビュー"`) を構築し、`mkdir(exist_ok=True)` で作成する。
          - 作成ログを出力する。
      6.  **内部レビュー 1 回目の生成**:
          - `create_review_files` を呼び出し、`DATE_SAMPLES["date1"]` (1 週間前) を使用して内部レビュー 1 回目のフォルダとファイルを生成する。`suffix` は `"社内_1 回目"`、`main_file_stem_for_review` を渡す。
      7.  **030 工程のみ内部レビュー 2 回目を生成**:
          - `p_num` が `"030"` の場合:
            - `create_review_files` を呼び出し、`DATE_SAMPLES["date2"]` (5 日前) を使用して内部レビュー 2 回目のフォルダとファイルを生成する。`suffix` は `"社内_2 回目"`、`main_file_stem_for_review` を渡す。
      8.  **外部レビューフォルダの作成**:
          - `external_review_dir` (`results_dir / "外部レビュー"`) を構築し、`mkdir(exist_ok=True)` で作成する。
          - 作成ログを出力する。
      9.  **外部レビューがある工程のみ作成**:
          - `p_num` が `"030"`, `"040"`, `"080"`, `"090"` のいずれかの場合:
            - **外部レビュー 1 回目の生成**:
              - `create_review_files` を呼び出し、`DATE_SAMPLES["date3"]` (3 日前) を使用して外部レビュー 1 回目のフォルダとファイルを生成する。`suffix` は `"社外_1 回目"`、`main_file_stem_for_review` を渡す。
              - 生成された日付フォルダ (`created_ext1_folder`) を取得する。
            - **030 工程のみ 2 回目の外部レビューファイルを追加**:
              - `p_num` が `"030"` の場合:
                - `create_file_with_title` を `FILE_TYPE_MAIN` で呼び出し、`created_ext1_folder` 内に `"調査 B"` というプレフィックスのファイルを生成する。`specific_title_key` は `"research"` とする。
                - `create_review_files` を呼び出し、`DATE_SAMPLES["date4"]` (1 日前) を使用して外部レビュー 2 回目のフォルダとファイルを生成する。`suffix` は `"社外_2 回目"`、`main_file_stem_for_review` は空リストを渡す (メイン成果物ファイルは上記で別途追加済みのため)。
7.  全体の完了ログを出力する。

# 6. データ定義 (`config.ini`)

本ツールは `config.ini` ファイルから以下の設定を読み込む。

```ini
[Paths]
# 生成される Teams フォルダ構造のルートパス
# 例: C:\temp\GeneratedTeamsProjects
sample_teams_root = C:\temp\GeneratedTeamsProjects

[Project]
# プロジェクト名 (生成されるフォルダ名の一部となる)
project_name = YourProjectName
# アイテム名または機能名 (生成されるフォルダ名の一部となる)
item_name = YourItemName

[title]
# 各成果物タイプに対応する正式名称または表示名
# create_dummy_excel_file 関数が Excel シート内に書き込むタイトルとして使用される
research = 調査検討書
sys_design = 機能設計書
unit_test_doc = 単体試験仕様書
unit_test_rst = 単体試験成績書
sys_test_doc = 結合試験仕様書
sys_test_rst = 結合試験成績書
test_rst_report = 試験結果報告書
review_checklist = レビューチェックリスト
review_minutes = レビュー記録表
```

# 7. 実行方法

上記設計書に基づき、Python スクリプトファイル (project_structure_generator.py など) を作成する。
スクリプトと同じディレクトリに config.ini ファイルを作成し、プロジェクトに応じた値を記述する。
必要な依存ライブラリ (openpyxl) をインストールする。
code
Bash
pip install openpyxl
ターミナルまたはコマンドプロンプトでスクリプトを実行する。
code
Bash
python project_structure_generator.py

# 8. ログ出力

本ツールは、処理の進行状況やエラー情報をログに出力する。
INFO レベル: フォルダ作成、ファイル作成の成功など、主要な処理の進行。
DEBUG レベル: タイトルキーの解決など、詳細な内部処理。
WARNING レベル: Excel ファイル生成失敗時のフォールバック処理など、軽微な問題。
ERROR レベル: 設定ファイルの読み込み失敗、無効なファイルタイプ指定など、処理続行が困難なエラー。

# 9. 備考

create_dummy_excel_file は Excel ファイルが生成できない環境でも動作するよう、テキストファイルでの代替処理を持つ。
レビューファイル生成時、主要成果物ファイルは指定された main_file_path_stems に基づいて日付フォルダ内に再生成される。これは、レビュー時点での成果物の状態を記録することを想定している。
030 工程のみ、内部レビューと外部レビューがそれぞれ 2 回分生成される特殊なロジックが組み込まれている。また、外部レビュー 2 回目では意図的にファイル名を変更したダミーファイル ("調査 B") が追加生成される。
画像が必要な場合は`
`タグを挿入してください。

```

```
